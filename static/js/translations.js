// Translation Management for AI Travel Planner
class TranslationManager {
    constructor() {
        this.currentLanguage = 'english';
        this.translations = {
            english: {
                // Header and Navigation
                plan_your_dream_trip: "Plan Your Dream Trip",
                ai_powered_planning: "AI-powered travel planning with Google ADK agents",
                
                // Form Labels
                from_city: "From City",
                select_from_city: "Select From City",
                destination: "Destination",
                select_destination: "Select Destination",
                theme: "Travel Theme",
                select_theme: "Select Theme",
                budget: "Budget (‚Çπ)",
                start_date: "Start Date",
                end_date: "End Date",
                duration: "Duration (Days)",
                generate_itinerary: "Generate Itinerary",
                
                // Itinerary Section
                your_itinerary: "Your Itinerary",
                edit_plan: "Edit Plan",
                book_trip: "Book This Trip",
                check_weather: "Check Weather Updates",
                
                // Booking Form
                book_your_trip: "Book Your Trip",
                personal_info: "Personal Information",
                full_name: "Full Name",
                email: "Email",
                phone: "Phone Number",
                travelers: "Number of Travelers",
                payment_info: "Payment Information",
                card_number: "Card Number",
                expiry: "Expiry Date",
                cvv: "CVV",
                cardholder: "Cardholder Name",
                total_amount: "Total Amount",
                confirm_booking: "Confirm Booking",
                
                // Modals and Messages
                weather_updates: "Weather Updates",
                booking_confirmed: "Booking Confirmed!",
                booking_success: "Your trip has been booked successfully!",
                generating_itinerary: "Generating your perfect itinerary...",
                
                // Footer
                powered_by_adk: "Powered by Google ADK",
                
                // Loading and Status
                loading: "Loading...",
                processing: "Processing...",
                please_wait: "Please wait..."
            },
            hindi: {
                // Header and Navigation
                plan_your_dream_trip: "‡§Ö‡§™‡§®‡•Ä ‡§∏‡§™‡§®‡•ã‡§Ç ‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç",
                ai_powered_planning: "Google ADK ‡§è‡§ú‡•á‡§Ç‡§ü‡•ç‡§∏ ‡§ï‡•á ‡§∏‡§æ‡§• AI-‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ",
                
                // Form Labels
                from_city: "‡§™‡•ç‡§∞‡§∏‡•ç‡§•‡§æ‡§® ‡§∂‡§π‡§∞",
                select_from_city: "‡§™‡•ç‡§∞‡§∏‡•ç‡§•‡§æ‡§® ‡§∂‡§π‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç",
                destination: "‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø",
                select_destination: "‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç",
                theme: "‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§•‡•Ä‡§Æ",
                select_theme: "‡§•‡•Ä‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç",
                budget: "‡§¨‡§ú‡§ü (‚Çπ)",
                start_date: "‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠ ‡§§‡§ø‡§•‡§ø",
                end_date: "‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡§ø ‡§§‡§ø‡§•‡§ø",
                duration: "‡§Ö‡§µ‡§ß‡§ø (‡§¶‡§ø‡§®)",
                generate_itinerary: "‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§¨‡§®‡§æ‡§è‡§Ç",
                
                // Itinerary Section
                your_itinerary: "‡§Ü‡§™‡§ï‡§æ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ",
                edit_plan: "‡§Ø‡•ã‡§ú‡§®‡§æ ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç",
                book_trip: "‡§á‡§∏ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡•ã ‡§¨‡•Å‡§ï ‡§ï‡§∞‡•á‡§Ç",
                check_weather: "‡§Æ‡•å‡§∏‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü ‡§¶‡•á‡§ñ‡•á‡§Ç",
                
                // Booking Form
                book_your_trip: "‡§Ö‡§™‡§®‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§¨‡•Å‡§ï ‡§ï‡§∞‡•á‡§Ç",
                personal_info: "‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
                full_name: "‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ",
                email: "‡§à‡§Æ‡•á‡§≤",
                phone: "‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞",
                travelers: "‡§Ø‡§æ‡§§‡•ç‡§∞‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ",
                payment_info: "‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
                card_number: "‡§ï‡§æ‡§∞‡•ç‡§° ‡§®‡§Ç‡§¨‡§∞",
                expiry: "‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡§ø ‡§§‡§ø‡§•‡§ø",
                cvv: "CVV",
                cardholder: "‡§ï‡§æ‡§∞‡•ç‡§°‡§ß‡§æ‡§∞‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ",
                total_amount: "‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø",
                confirm_booking: "‡§¨‡•Å‡§ï‡§ø‡§Ç‡§ó ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç",
                
                // Modals and Messages
                weather_updates: "‡§Æ‡•å‡§∏‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü",
                booking_confirmed: "‡§¨‡•Å‡§ï‡§ø‡§Ç‡§ó ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§π‡•ã ‡§ó‡§à!",
                booking_success: "‡§Ü‡§™‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡•Å‡§ï ‡§π‡•ã ‡§ó‡§à ‡§π‡•à!",
                generating_itinerary: "‡§Ü‡§™‡§ï‡§æ ‡§™‡§∞‡§´‡•á‡§ï‡•ç‡§ü ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...",
                
                // Footer
                powered_by_adk: "Google ADK ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§",
                
                // Loading and Status
                loading: "‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...",
                processing: "‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó...",
                please_wait: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç..."
            }
        };
    }

    init() {
        console.log('üåê Initializing Translation Manager...');
        this.applyTranslations();
    }

    async switchLanguage(language) {
        if (!this.translations[language]) {
            console.warn(`‚ö†Ô∏è Language '${language}' not supported`);
            return;
        }

        console.log(`üåê Switching to ${language}`);
        this.currentLanguage = language;
        
        // Apply translations to existing elements
        this.applyTranslations();
        
        // Notify server about language change (if needed for backend translations)
        try {
            const response = await fetch('/api/translate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    text: 'Language switched',
                    target_language: language
                })
            });
            
            if (response.ok) {
                console.log('‚úÖ Language preference updated on server');
            }
            
        } catch (error) {
            console.log('‚ÑπÔ∏è Could not notify server about language change:', error.message);
        }
    }

    applyTranslations() {
        const elements = document.querySelectorAll('[data-translate]');
        const currentTranslations = this.translations[this.currentLanguage];
        
        elements.forEach(element => {
            const key = element.getAttribute('data-translate');
            if (currentTranslations[key]) {
                // Handle different element types
                if (element.tagName === 'INPUT' && element.type === 'submit') {
                    element.value = currentTranslations[key];
                } else if (element.tagName === 'INPUT' && element.placeholder) {
                    element.placeholder = currentTranslations[key];
                } else if (element.tagName === 'OPTION') {
                    element.textContent = currentTranslations[key];
                } else {
                    element.textContent = currentTranslations[key];
                }
            }
        });
        
        // Update document direction for languages that need it
        if (this.currentLanguage === 'hindi') {
            document.documentElement.setAttribute('lang', 'hi');
        } else {
            document.documentElement.setAttribute('lang', 'en');
        }
    }

    translate(key) {
        return this.translations[this.currentLanguage][key] || key;
    }

    // Translate dynamic content (for itinerary items, etc.)
    async translateDynamicContent(text, targetLanguage = null) {
        const lang = targetLanguage || this.currentLanguage;
        
        if (lang === 'english') {
            return text; // No translation needed
        }
        
        try {
            const response = await fetch('/api/translate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    text: text,
                    target_language: lang
                })
            });
            
            if (response.ok) {
                const result = await response.json();
                return result.translated_text || text;
            }
            
        } catch (error) {
            console.error('‚ùå Translation error:', error);
        }
        
        return text; // Return original text if translation fails
    }

    // Helper method to translate arrays of text
    async translateArray(textArray, targetLanguage = null) {
        const promises = textArray.map(text => 
            this.translateDynamicContent(text, targetLanguage)
        );
        
        try {
            return await Promise.all(promises);
        } catch (error) {
            console.error('‚ùå Batch translation error:', error);
            return textArray; // Return original array if translation fails
        }
    }

    // Get available languages
    getAvailableLanguages() {
        return Object.keys(this.translations);
    }

    // Add new translations at runtime
    addTranslations(language, translations) {
        if (!this.translations[language]) {
            this.translations[language] = {};
        }
        
        Object.assign(this.translations[language], translations);
        console.log(`‚úÖ Added translations for ${language}`);
    }

    // Get current language display name
    getCurrentLanguageDisplay() {
        const languageNames = {
            english: 'English',
            hindi: '‡§π‡§ø‡§Ç‡§¶‡•Ä'
        };
        
        return languageNames[this.currentLanguage] || this.currentLanguage;
    }
}

// Create global instance
window.translations = new TranslationManager();

// Auto-initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        window.translations.init();
    });
} else {
    window.translations.init();
}

// Export for use in modules
if (typeof module !== 'undefined' && module.exports) {
    module.exports = TranslationManager;
}